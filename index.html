<!doctype html>
<!--
  Happy Diwali â€” Fireworks (mandatory name + heartfelt wish)
  Features:
  - Asks user name (mandatory)
  - Fireworks begin only after entering name
  - Name displayed in uppercase with a warm heartfelt wish
  - Infinite fireworks with vibrant colors
-->
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Happy Diwali â€” Fireworks</title>
  <style>
    :root{
      --bg:#0b0b12;
      --text:#ffd54a;
      --overlay:rgba(0,0,0,0.25);
    }
    html,body{height:100%;margin:0;font-family:'Poppins',system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial}
    body{
      background: radial-gradient(ellipse at center, #0f1724 0%, var(--bg) 60%);
      overflow:hidden;color:var(--text);
      display:flex;align-items:center;justify-content:center;
      -webkit-font-smoothing:antialiased;text-rendering:optimizeLegibility;
    }

    canvas{display:block;position:fixed;inset:0;z-index:0}

    .centerMessage{position:fixed;z-index:9;left:50%;top:50%;transform:translate(-50%,-50%);text-align:center;max-width:90%;}
    .greeting{font-size:clamp(22px,4vw,42px);margin:0 0 10px;text-transform:uppercase;letter-spacing:2px;font-weight:700;color:#ffd54a;text-shadow:0 0 15px #ffb300,0 0 30px #ff9800;line-height: 1.4;width:90vw;}
    .wish{font-size:0.9em;opacity:0.95;max-width:600px;margin:auto;line-height:1.6;color:#ffe082;text-shadow:0 0 10px rgba(255,200,0,0.3);font-weight: 600;width: 80vw;}
    .timer{font-size:1.5em;opacity:0.95;max-width:600px;margin:auto;line-height:1.6;color:#ffe082;text-shadow:0 0 10px rgba(255,200,0,0.3);font-weight: 600;width: 80vw;}
    .modal{position:fixed;z-index:20;left:50%;top:50%;transform:translate(-50%,-50%);background:linear-gradient(180deg, rgba(10,10,10,0.9), rgba(20,20,20,0.85));padding:24px;border-radius:16px;box-shadow:0 10px 40px rgba(0,0,0,0.6);width:min(440px,92%);text-align:center}
    .modal h2{margin:0 0 12px;font-size:22px;color:#ffd54a}
    .modal input{width:100%;padding:12px 14px;border-radius:10px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:var(--text);outline:none;font-size:17px;text-align:center}
    .modal .btn{background:#ffb300;color:#000;border:none;padding:10px 16px;border-radius:10px;font-weight:700;cursor:pointer;width:100%;margin-top:14px;transition:0.3s}
    .modal .btn:hover{background:#ffc107;}

    @media (max-width:450px){
    .greeting{font-size:1.1em;margin:0 0 10px;text-transform:uppercase;letter-spacing:2px;font-weight:700;color:#ffd54a;text-shadow:0 0 15px #ffb300,0 0 30px #ff9800;line-height: 1.4;width:90vw;display: inline;height: 5vh;}
    .wish{font-size:clamp(14px,2vw,20px);opacity:0.95;max-width:600px;margin-top:10px;line-height:1.6;color:#ffe082;text-shadow:0 0 10px rgba(255,200,0,0.3);font-weight: 600;width: 80vw;}
      .modal{padding:16px}
    }
  </style>
</head>
<body>
  <canvas id="c"></canvas>

  <div class="centerMessage" id="greetingBox" style="display:none">
    <div class="greeting" id="greeting"></div>
    <div class="wish" id="wish"></div>
    <div class="timer"></div>
  </div>

  <div class="modal" id="nameModal" aria-modal="true">
    <h2>Please Enter your name </h2>
    <input id="nameInput" placeholder="Enter your name here..." autocomplete="off" />
    <button id="startBtn" class="btn" style="font-weight: 600;">Start Celebration</button>
  </div>
  <audio id="fireworkSound" src="fireworks.wav" preload="auto"></audio>
  <script>
  (function(){
  const canvas = document.getElementById('c');
  const ctx = canvas.getContext('2d');
  let DPR = Math.max(1, window.devicePixelRatio || 1);
  let w = 0, h = 0;

  function resize(){
    DPR = Math.max(1, window.devicePixelRatio || 1);
    w = window.innerWidth;
    h = window.innerHeight;
    canvas.width = w * DPR;
    canvas.height = h * DPR;
    canvas.style.width = w + 'px';
    canvas.style.height = h + 'px';
    ctx.setTransform(DPR, 0, 0, DPR, 0, 0);
  }
  window.addEventListener('resize', () => setTimeout(resize, 150), {passive:true});
  resize();

  const fireworks = [], particles = [];
  const gravity = 0.06, airDrag = 0.995;
  const palette = ['#ff4d4d','#ffd166','#06d6a0','#118ab2','#9b5de5','#ff6b6b','#ffc6ff','#ffd700'];
  function rand(min, max){ return Math.random()*(max-min)+min }

  class Firework {
    constructor(x,y,tx,ty,color){
      this.x = x; this.y = y; this.tx = tx; this.ty = ty;
      this.speed = rand(4,8);
      this.angle = Math.atan2(ty-y, tx-x);
      this.vx = Math.cos(this.angle)*this.speed;
      this.vy = Math.sin(this.angle)*this.speed;
      this.color = color; this.done = false; this.size = 3;
    }
    update(){
      this.vx *= 0.998; this.vy *= 0.998; this.vy += gravity*0.2;
      this.x += this.vx; this.y += this.vy;
      if(Math.hypot(this.tx - this.x, this.ty - this.y) < 8 || this.vy > 5){
        this.explode(); this.done = true;
      }
    }
    explode(){
      const count = Math.floor(rand(30,60));
      for(let i=0;i<count;i++){
        const angle = Math.PI*2 * Math.random();
        const speed = rand(1.5,6);
        const vx = Math.cos(angle)*speed;
        const vy = Math.sin(angle)*speed;
        particles.push(new Particle(this.x,this.y,vx,vy,this.color));
      }
    }
    draw(ctx){
      ctx.save();
      ctx.beginPath();
      ctx.fillStyle = this.color;
      ctx.globalCompositeOperation = 'lighter';
      ctx.arc(this.x,this.y,this.size,0,Math.PI*2);
      ctx.fill();
      ctx.restore();
    }
  }

  class Particle {
    constructor(x,y,vx,vy,color){
      this.x = x; this.y = y; this.vx = vx; this.vy = vy;
      this.life = 1; this.decay = rand(0.01, 0.03);
      this.size = rand(1,3); this.color = color;
    }
    update(){
      this.vx *= airDrag; this.vy *= airDrag; this.vy += gravity;
      this.x += this.vx; this.y += this.vy; this.life -= this.decay;
    }
    draw(ctx){
      if(this.life <= 0) return;
      ctx.save();
      ctx.globalAlpha = this.life;
      ctx.globalCompositeOperation = 'lighter';
      const g = ctx.createRadialGradient(this.x,this.y,0,this.x,this.y,this.size*8);
      g.addColorStop(0,this.color);
      g.addColorStop(0.3,this.color+'66');
      g.addColorStop(1,'rgba(0,0,0,0)');
      ctx.fillStyle = g;
      ctx.beginPath();
      ctx.arc(this.x,this.y,this.size*8,0,Math.PI*2);
      ctx.fill();
      ctx.restore();
    }
  }

  function spawnFirework(x=null, y=null){
    const sx = x || rand(w*0.1,w*0.9);
    const sy = y || h+10;
    const tx = x || rand(w*0.15,w*0.85);
    const ty = y || rand(h*0.1,h*0.6);
    const color = palette[Math.floor(rand(0,palette.length))];
    fireworks.push(new Firework(sx,sy,tx,ty,color));
  }

  let started = false;
  function update(){
    if(!started) return;
    if(Math.random() < 0.06) spawnFirework();
    for(let i=fireworks.length-1; i>=0; i--){
      fireworks[i].update();
      if(fireworks[i].done) fireworks.splice(i,1);
    }
    for(let i=particles.length-1; i>=0; i--){
      particles[i].update();
      if(particles[i].life <= 0) particles.splice(i,1);
    }
  }

  function draw(){
    ctx.globalCompositeOperation = 'destination-out';
    ctx.fillStyle = 'rgba(0,0,0,0.25)';
    ctx.fillRect(0,0,w,h);
    ctx.globalCompositeOperation = 'lighter';
    for(const f of fireworks) f.draw(ctx);
    for(const p of particles) p.draw(ctx);
  }

  let last = performance.now();
  function frame(now){
    const delta = now - last;
    last = now;
    update(delta);
    draw();
    requestAnimationFrame(frame);
  }
  requestAnimationFrame(frame);

  // DOM elements
  const nameModal = document.getElementById('nameModal');
  const nameInput = document.getElementById('nameInput');
  const startBtn = document.getElementById('startBtn');
  const greetingEl = document.getElementById('greeting');
  const wishEl = document.getElementById('wish');
  const greetingBox = document.getElementById('greetingBox');
  const fireworkSound = document.getElementById('fireworkSound');

  function startCelebration(name){
    if(!name.trim()){
      alert('Please enter your name to begin the celebration!');
      return;
    }
    started = true;
    nameModal.style.display = 'none';
    greetingBox.style.display = 'block';
    const upperName = name.trim().toUpperCase();
    greetingEl.textContent = `âœ¨ HAPPY DIWALI ${upperName} âœ¨`;
    wishEl.innerHTML = `May this Diwali light up your life with <br> endless happiness, peace, and prosperity.<br>Sending warm wishes and sparkling smiles<br> your way - from Vivek ðŸ’«`;
    for(let i=0; i<15; i++) spawnFirework();
    fireworkSound.play().catch(()=>{});
  }

  startBtn.addEventListener('click', () => {
    fireworkSound.play().catch(()=>{});
    startCelebration(nameInput.value);
  });
  nameInput.addEventListener('keydown', e => {
    if(e.key === 'Enter') startCelebration(nameInput.value);
  });

  // Touch and click fireworks
  canvas.addEventListener('touchstart', e => {
    if(!started) return;
    const touch = e.touches[0];
    const x = touch.clientX;
    const y = touch.clientY;
    const color = palette[Math.floor(rand(0, palette.length))];
    fireworks.push(new Firework(x, y + 20, x, y, color));
    fireworkSound.currentTime = 0;
    fireworkSound.play().catch(()=>{});
    if (navigator.vibrate) navigator.vibrate(100);
  });

  canvas.addEventListener('mousedown', e => {
    if(!started) return;
    const x = e.clientX;
    const y = e.clientY;
    const color = palette[Math.floor(rand(0, palette.length))];
    fireworks.push(new Firework(x, y + 20, x, y, color));
    fireworkSound.currentTime = 0;
    fireworkSound.play().catch(()=>{});
  });

  nameInput.focus();
})();

// Countdown logic
const diwali = document.querySelector(".timer");
function updateCountdown() {
  const diwaliStart = new Date('2025-10-20T00:00:00+05:30');
  const now = new Date();
  const diff = diwaliStart - now;

  if (diff <= 0) {
    diwali.textContent = "ðŸŽŠ Diwali has begun!";
    clearInterval(timer);
    return;
  }

  const days = Math.floor(diff / (1000 * 60 * 60 * 24));
  const hours = Math.floor((diff / (1000 * 60 * 60)) % 24);
  const minutes = Math.floor((diff / (1000 * 60)) % 60);
  const seconds = Math.floor((diff / 1000) % 60);
  diwali.textContent = `${days}d ${hours}h ${minutes} ${seconds}s left`;
  }

  const timer = setInterval(updateCountdown, 1000);
  updateCountdown();
</script>
</body>
</html>

